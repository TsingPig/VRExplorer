name: Sync Assets/Explorer to Release Branch

on:
  push:
    paths:
      - 'Assets/Explorer/**'
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 获取完整历史记录

      - name: Setup Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Authenticate with Personal Access Token
        run: |
          git remote set-url origin https://x-access-token:${{ secrets.GH_PAT }}@github.com/TsingPig/VRExplorer.git

      - name: Fetch All Branches
        run: |
          git fetch --all

      - name: Create or Switch to Release Branch
        run: |
          if git ls-remote --heads origin release | grep release; then
            git checkout release
            git rm -rf .  # 清除 release 分支的所有内容
            git commit -m "Clear release branch"
          else
            git checkout --orphan release  # 创建新的空分支
            git commit --allow-empty -m "Initial empty commit"
            git push origin release
          fi

      - name: Sync Assets/Explorer to Release Branch
        run: |
          git checkout main -- Assets/Explorer  # 从 main 分支提取 Assets/Explorer
          git add Assets/Explorer
          git commit -m "Update Assets/Explorer from main"
          git push origin release