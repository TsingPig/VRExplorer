name: Sync Folder
on:
  push:
    paths:
      - 'Assets/VRExplorer/**'
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

      - name: Prepare sync
        run: |
          # 设置变量
          FOLDER_PATH="Assets/VRExplorer"
          NEW_REPO="VRExplorer_Release"
          NEW_REPO_URL="https://${{ secrets.GH_PAT }}@github.com/${{ github.repository_owner }}/$NEW_REPO.git"
          TEMP_DIR="sync_temp_$(date +%s)"

          # 创建临时工作目录
          mkdir $TEMP_DIR
          cd $TEMP_DIR

          # 初始化全新仓库
          git init -b main
          git remote add origin $NEW_REPO_URL

          # 清空目标仓库（创建空提交）
          git commit --allow-empty -m "Initial empty commit"
          git push origin main --force

          # 复制新内容
          cp -r "../../$FOLDER_PATH"/* .
          git add .
          git commit -m "Complete folder sync at $(date -u)"
          git push origin main